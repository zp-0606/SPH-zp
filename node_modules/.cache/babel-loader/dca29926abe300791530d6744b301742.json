{"ast":null,"code":"//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport QRCode from 'qrcode';\nexport default {\n  name: \"Pay\",\n\n  data() {\n    return {\n      payInfo: {},\n      timer: '',\n      code: ''\n    };\n  },\n\n  computed: {\n    orderId() {\n      return this.$route.query.orderId;\n    }\n\n  },\n\n  mounted() {\n    this.getPayInfo();\n  },\n\n  methods: {\n    async getPayInfo() {\n      let result = await this.$API.reqPayInfo(this.orderId);\n\n      if (result.code == 200) {\n        this.payInfo = result.data;\n      }\n    },\n\n    async open() {\n      let url = await QRCode.toDataURL(this.payInfo.codeUrl);\n      this.$alert(`<img src=${url} />`, '请你微信支付', {\n        dangerouslyUseHTMLString: true,\n        center: true,\n        showCancelButton: true,\n        cancelButtonText: '支付遇到问题',\n        confirmButtonText: '已成功支付',\n        showClose: false,\n        beforeClose: (type, instance, done) => {\n          if (type == 'cancel') {\n            alert('请联系管理员');\n            clearInterval(this.timer);\n            this.timer = null;\n            done();\n          } else {\n            // if(this.code==200){\n            clearInterval(this.timer);\n            this.timer = null;\n            done();\n            this.$router.push('/paysuccess'); // }\n          }\n        }\n      });\n\n      if (!this.timer) {\n        this.timer = setInterval(async () => {\n          let result = await this.$API.reqPayStatus(this.orderId);\n\n          if (result.code == 200) {\n            clearInterval(this.timer);\n            this.timer = null;\n            this.code = result.code;\n            this.$msgbox.close();\n            this.$router.push('/paysuccess');\n          }\n        }, 2000);\n      }\n    }\n\n  }\n};","map":null,"metadata":{},"sourceType":"module"}
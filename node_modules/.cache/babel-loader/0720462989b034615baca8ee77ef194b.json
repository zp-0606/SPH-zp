{"ast":null,"code":"import Vue from 'vue';\nimport VueRouter from 'vue-router';\nimport routes from './routes';\nimport store from '@/store';\nVue.use(VueRouter);\nlet originPush = VueRouter.prototype.push;\nlet originReplace = VueRouter.prototype.replace;\n\nVueRouter.prototype.push = function (location, resolve, reject) {\n  if (resolve && reject) {\n    originPush.call(this, location, resolve, reject);\n  } else {\n    originPush.call(this, location, () => {}, () => {});\n  }\n};\n\nVueRouter.prototype.replace = function (location, resolve, reject) {\n  if (resolve && reject) {\n    originReplace.call(this, location, resolve, reject);\n  } else {\n    originReplace.call(this, location, () => {}, () => {});\n  }\n};\n\nlet router = new VueRouter({\n  routes,\n\n  scrollBehavior(to, from, savePosition) {\n    return {\n      y: 0\n    };\n  }\n\n});\nrouter.beforeEach(async (to, from, next) => {\n  let token = store.state.user.token;\n  let username = store.state.user.userInfo.name;\n\n  if (token) {\n    if (to.path == '/login' || to.path == '/register') {\n      next('/');\n    } else {\n      if (username) {\n        next();\n      } else {\n        try {\n          await store.dispatch('getUserInfo');\n          next();\n        } catch (error) {\n          await store.dispatch('userLogOut');\n          next('/login');\n        }\n      }\n    }\n  } else {\n    let toPath = to.path;\n\n    if (toPath.indexOf('/pay') != -1 || toPath.indexOf('/trade') != -1 || toPath.indexOf('/center') != -1) {\n      next('/login?redirect=' + toPath);\n    } else {\n      next();\n    }\n  }\n});\nexport default router;","map":{"version":3,"sources":["E:/VueProject/project-SPH/app/src/router/index.js"],"names":["Vue","VueRouter","routes","store","use","originPush","prototype","push","originReplace","replace","location","resolve","reject","call","router","scrollBehavior","to","from","savePosition","y","beforeEach","next","token","state","user","username","userInfo","name","path","dispatch","error","toPath","indexOf"],"mappings":"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","sourcesContent":["import Vue from 'vue';\r\nimport VueRouter from 'vue-router';\r\nimport routes from './routes'\r\nimport store from '@/store'\r\nVue.use(VueRouter);\r\n\r\n\r\nlet originPush = VueRouter.prototype.push;\r\nlet originReplace = VueRouter.prototype.replace;\r\nVueRouter.prototype.push = function (location, resolve, reject) {\r\n    if (resolve && reject) {\r\n        originPush.call(this, location, resolve, reject)\r\n    } else {\r\n        originPush.call(this, location, () => { }, () => { })\r\n    }\r\n}\r\nVueRouter.prototype.replace = function (location, resolve, reject) {\r\n    if (resolve && reject) {\r\n        originReplace.call(this, location, resolve, reject)\r\n    } else {\r\n        originReplace.call(this, location, () => { }, () => { })\r\n    }\r\n}\r\nlet router = new VueRouter({\r\n    routes,\r\n    scrollBehavior(to, from, savePosition) {\r\n        return { y: 0 }\r\n    }\r\n})\r\nrouter.beforeEach(async (to, from, next) => {\r\n    let token = store.state.user.token\r\n    let username = store.state.user.userInfo.name\r\n    if (token) {\r\n        if (to.path == '/login' || to.path == '/register') {        \r\n            next('/')\r\n        } else {\r\n            if (username) {\r\n                next()\r\n            } else {\r\n                try {\r\n                    await store.dispatch('getUserInfo')\r\n                    next()\r\n                } catch (error) {\r\n                    await store.dispatch('userLogOut')\r\n                    next('/login')\r\n                }\r\n            }\r\n        }\r\n    } else {\r\n        let toPath = to.path\r\n        if (toPath.indexOf('/pay') != -1 || toPath.indexOf('/trade') != -1 || toPath.indexOf('/center') != -1) {\r\n            next('/login?redirect='+toPath)\r\n        } else {\r\n            next()\r\n        }\r\n    }\r\n})\r\n\r\nexport default router"]},"metadata":{},"sourceType":"module"}